## 테스트 전략

### 접근 방식

- 방법론: TDD (Test-Driven Development)
- 원칙: F.I.R.S.T 원칙 준수
- 중점: 사용자 시나리오 중심, 비즈니스 가치 검증

### 중점 영역

1.  핵심 비즈니스 로직: 반복 일정 삭제 로직 (단일 및 전체 그룹), `deleteAllRecurringEvents` 함수의 정확성
2.  사용자 인터랙션: 삭제 버튼 클릭, 다이얼로그 표시, 다이얼로그 내 버튼 클릭, 스낵바 메시지 표시
3.  에러 처리: API 호출 실패 시 사용자 피드백 및 시스템 안정성 유지
4.  데이터 무결성: 올바른 일정만 삭제되고 나머지 일정은 유지되는지 검증

### 목표 커버리지

- 라인 커버리지: 90% (새로 추가되거나 수정된 로직에 대해)
- 브랜치 커버리지: 85% (모든 조건문 분기)
- 함수 커버리지: 95% (public 함수)
- 중요: 단순 커버리지 숫자보다 의미있는 테스트 작성

### 테스트 우선순위

1.  High: 반복 일정 삭제 다이얼로그 표시 및 올바른 삭제 동작 (단일/전체), 에러 처리
2.  Medium: 다이얼로그 닫기, 스낵바 메시지 정확성
3.  Low: (현재 기능 범위에 해당 없음)

## 테스트 케이스 목록

### TC001: 반복 일정 삭제 버튼 클릭 시 다이얼로그 표시

- 기능 ID: F001
- 테스트 유형: integration
- 우선순위: high
- 설명: 반복 일정의 삭제 버튼 클릭 시 사용자에게 삭제 유형을 선택할 수 있는 다이얼로그가 올바르게 표시되는지 검증합니다.
- Given (초기 조건):
  - 반복 일정이 렌더링된 상태
  - `isRepeatEvent` 함수가 해당 일정을 반복 일정으로 인식하도록 Mock 설정
- When (실행 동작):
  - 사용자가 반복 일정 옆의 삭제 아이콘 버튼을 클릭
- Then (예상 결과):
  - "해당 일정만 삭제하시겠어요?" 메시지가 포함된 다이얼로그가 화면에 표시됨
  - 다이얼로그 내에 "예 (이 일정만)" 버튼과 "아니오 (모든 일정)" 버튼이 표시됨
- 검증 포인트:
  1. 중요: 다이얼로그가 화면에 렌더링되었는지 확인
  2. 부가 검증: 다이얼로그의 제목 및 버튼 텍스트가 올바른지 확인
- 엣지 케이스: (해당 없음)
- Mock/Stub 요구사항:
  - `useEventOperations` 훅 Mock (특히 `deleteEvent`, `deleteAllRecurringEvents` 호출 방지)
  - `isRepeatEvent` 함수 Mock

### TC002: 단일 일정 삭제 버튼 클릭 시 다이얼로그 없이 즉시 삭제

- 기능 ID: F001
- 테스트 유형: integration
- 우선순위: medium
- 설명: 단일 일정의 삭제 버튼 클릭 시 다이얼로그 없이 기존의 `deleteEvent` 함수가 즉시 호출되는지 검증합니다.
- Given (초기 조건):
  - 단일 일정이 렌더링된 상태
  - `isRepeatEvent` 함수가 해당 일정을 단일 일정으로 인식하도록 Mock 설정
  - `useEventOperations`의 `deleteEvent` 함수가 Mocking되어 호출 여부 추적 가능
- When (실행 동작):
  - 사용자가 단일 일정 옆의 삭제 아이콘 버튼을 클릭
- Then (예상 결과):
  - 삭제 확인 다이얼로그가 표시되지 않음
  - `deleteEvent` 함수가 해당 일정 ID로 호출됨
  - 성공 스낵바 메시지가 표시될 수 있음 (기존 동작)
- 검증 포인트:
  1. 중요: 삭제 확인 다이얼로그가 화면에 표시되지 않았는지 확인
  2. 부가 검증: `deleteEvent` 함수가 정확한 인자와 함께 호출되었는지 확인
- 엣지 케이스: (해당 없음)
- Mock/Stub 요구사항:
  - `useEventOperations` 훅 Mock (특히 `deleteEvent` 함수 Mock)
  - `isRepeatEvent` 함수 Mock

### TC003: 다이얼로그에서 "예 (이 일정만)" 클릭 시 해당 일정만 삭제

- 기능 ID: F002
- 테스트 유형: integration
- 우선순위: high
- 설명: 반복 일정 삭제 다이얼로그에서 "예 (이 일정만)" 옵션을 선택했을 때, 선택된 일정만 삭제되고 나머지 반복 그룹 일정은 유지되는지 검증합니다.
- Given (초기 조건):
  - 반복 일정 (예: `eventA`) 및 같은 그룹의 다른 반복 일정 (예: `eventB`)이 렌더링된 상태
  - `eventA`에 대한 삭제 다이얼로그가 열려있는 상태
  - `useEventOperations`의 `deleteEvent` 함수가 Mocking되어 호출 여부 추적 가능
- When (실행 동작):
  - 사용자가 다이얼로그에서 "예 (이 일정만)" 버튼을 클릭
- Then (예상 결과):
  - 다이얼로그가 닫힘
  - `deleteEvent` 함수가 `eventA.id`를 인자로 호출됨
  - `eventA`는 화면에서 사라지고, `eventB`는 여전히 화면에 존재함
  - 성공 스낵바 메시지가 표시됨 (예: "일정이 삭제되었습니다.")
- 검증 포인트:
  1. 중요: `deleteEvent`가 올바른 단일 일정 ID로 호출되었는지 확인
  2. 부가 검증: 다이얼로그가 닫히고, 선택된 일정만 사라졌는지 확인
  3. 부가 검증: 스낵바 메시지가 올바르게 표시되는지 확인
- 엣지 케이스:
  - API 호출 실패 시: 에러 스낵바 메시지가 표시되고 다이얼로그는 닫힘 (TC004에서 다룸)
- Mock/Stub 요구사항:
  - `useEventOperations` 훅 Mock (특히 `deleteEvent` 함수 Mock)
  - `callApi` Mock (성공 응답)

### TC004: 단일 반복 일정 삭제 API 호출 실패 시 에러 처리

- 기능 ID: F002
- 테스트 유형: integration
- 우선순위: high
- 설명: "예 (이 일정만)" 클릭 시 단일 일정 삭제 API 호출이 실패했을 때, 사용자에게 에러 메시지가 표시되고 시스템이 안정적으로 유지되는지 검증합니다.
- Given (초기 조건):
  - 반복 일정에 대한 삭제 다이얼로그가 열려있는 상태
  - `useEventOperations`의 `deleteEvent` 함수가 Mocking되어 API 호출 시 실패 응답을 반환하도록 설정
- When (실행 동작):
  - 사용자가 다이얼로그에서 "예 (이 일정만)" 버튼을 클릭
- Then (예상 결과):
  - 다이얼로그가 닫힘
  - `deleteEvent` 함수가 호출되었으나 내부적으로 에러 처리됨
  - "일정 삭제에 실패했습니다."와 같은 에러 스낵바 메시지가 표시됨
  - 일정이 화면에서 사라지지 않고 유지됨
- 검증 포인트:
  1. 중요: 에러 스낵바 메시지가 올바르게 표시되었는지 확인
  2. 부가 검증: 다이얼로그가 닫히고, 일정이 삭제되지 않고 유지되는지 확인
- 엣지 케이스:
  - 네트워크 오류, 서버 오류 등 다양한 실패 시나리오
- Mock/Stub 요구사항:
  - `useEventOperations` 훅 Mock (특히 `deleteEvent` 함수 Mock)
  - `callApi` Mock (실패 응답)

### TC005: 다이얼로그에서 "아니오 (모든 일정)" 클릭 시 모든 반복 일정 삭제

- 기능 ID: F003
- 테스트 유형: integration
- 우선순위: high
- 설명: 반복 일정 삭제 다이얼로그에서 "아니오 (모든 일정)" 옵션을 선택했을 때, 동일한 반복 그룹의 모든 일정이 삭제되는지 검증합니다.
- Given (초기 조건):
  - 반복 일정 그룹 (예: `eventA`, `eventB`, `eventC`)이 렌더링된 상태
  - `eventA`에 대한 삭제 다이얼로그가 열려있는 상태
  - `useEventOperations`의 `deleteAllRecurringEvents` 함수가 Mocking되어 호출 여부 추적 가능
  - `findRecurringGroupEvents`가 해당 그룹의 모든 일정을 반환하도록 Mock 설정
- When (실행 동작):
  - 사용자가 다이얼로그에서 "아니오 (모든 일정)" 버튼을 클릭
- Then (예상 결과):
  - 다이얼로그가 닫힘
  - `deleteAllRecurringEvents` 함수가 `eventA`를 인자로 호출됨
  - `eventA`, `eventB`, `eventC` 모두 화면에서 사라짐
  - 성공 스낵바 메시지가 표시됨 (예: "모든 반복 일정이 삭제되었습니다.")
- 검증 포인트:
  1. 중요: `deleteAllRecurringEvents`가 올바른 참조 이벤트와 함께 호출되었는지 확인
  2. 부가 검증: 다이얼로그가 닫히고, 모든 반복 일정이 화면에서 사라졌는지 확인
  3. 부가 검증: 스낵바 메시지가 올바르게 표시되는지 확인
- 엣지 케이스:
  - API 호출 실패 시: 에러 스낵바 메시지가 표시되고 다이얼로그는 닫힘 (TC006에서 다룸)
- Mock/Stub 요구사항:
  - `useEventOperations` 훅 Mock (특히 `deleteAllRecurringEvents` 함수 Mock)
  - `findRecurringGroupEvents` Mock
  - `callApi` Mock (성공 응답)

### TC006: 모든 반복 일정 삭제 API 호출 실패 시 에러 처리

- 기능 ID: F003
- 테스트 유형: integration
- 우선순위: high
- 설명: "아니오 (모든 일정)" 클릭 시 `deleteAllRecurringEvents` 함수 내에서 API 호출이 실패했을 때, 사용자에게 에러 메시지가 표시되고 시스템이 안정적으로 유지되는지 검증합니다.
- Given (초기 조건):
  - 반복 일정에 대한 삭제 다이얼로그가 열려있는 상태
  - `useEventOperations`의 `deleteAllRecurringEvents` 함수가 Mocking되어 API 호출 시 실패 응답을 반환하도록 설정
- When (실행 동작):
  - 사용자가 다이얼로그에서 "아니오 (모든 일정)" 버튼을 클릭
- Then (예상 결과):
  - 다이얼로그가 닫힘
  - `deleteAllRecurringEvents` 함수가 호출되었으나 내부적으로 에러 처리됨
  - "모든 반복 일정 삭제에 실패했습니다."와 같은 에러 스낵바 메시지가 표시됨
  - 일정이 화면에서 사라지지 않고 유지됨 (부분 삭제가 발생했다면 해당 시나리오도 고려)
- 검증 포인트:
  1. 중요: 에러 스낵바 메시지가 올바르게 표시되었는지 확인
  2. 부가 검증: 다이얼로그가 닫히고, 일정이 삭제되지 않고 유지되는지 확인
- 엣지 케이스:
  - 여러 일정 중 일부만 삭제 실패 시 (부분 성공/실패 시나리오)
- Mock/Stub 요구사항:
  - `useEventOperations` 훅 Mock (특히 `deleteAllRecurringEvents` 함수 Mock)
  - `findRecurringGroupEvents` Mock
  - `callApi` Mock (실패 응답)

### TC007: 다이얼로그 외부 클릭 또는 ESC 키 입력 시 다이얼로그 닫기

- 기능 ID: F001
- 테스트 유형: integration
- 우선순위: medium
- 설명: 반복 일정 삭제 다이얼로그가 표시된 상태에서 사용자가 외부를 클릭하거나 ESC 키를 눌렀을 때, 다이얼로그가 닫히고 어떤 일정도 삭제되지 않는지 검증합니다.
- Given (초기 조건):
  - 반복 일정에 대한 삭제 다이얼로그가 열려있는 상태
  - `useEventOperations`의 `deleteEvent`, `deleteAllRecurringEvents` 함수가 Mocking되어 호출 여부 추적 가능
- When (실행 동작):
  - 사용자가 다이얼로그 외부를 클릭하거나 ESC 키를 누름
- Then (예상 결과):
  - 다이얼로그가 화면에서 사라짐
  - `deleteEvent` 또는 `deleteAllRecurringEvents` 함수가 호출되지 않음
  - 모든 일정이 화면에 그대로 유지됨
- 검증 포인트:
  1. 중요: 다이얼로그가 닫혔는지 확인
  2. 부가 검증: 삭제 관련 함수가 호출되지 않았는지 확인
  3. 부가 검증: 일정이 그대로 유지되는지 확인
- 엣지 케이스: (해당 없음)
- Mock/Stub 요구사항:
  - `useEventOperations` 훅 Mock

## 테스트 구조 설계

### 파일 구조

```
src/__tests__/
  ├── unit/
  │   └── useEventOperations.spec.ts  # deleteAllRecurringEvents 내부 로직
  ├── integration/
  │   └── App.recurringDelete.spec.tsx # UI 및 훅 통합 테스트
  └── e2e/
      └── (필요시 추가)
```

### 테스트 파일 명명 규칙

- `[테스트대상].[난이도].[타입].spec.ts`
- 예: `App.recurringDelete.medium.integration.spec.tsx`

## 테스트 피라미드 구성

### 분포

- 단위 테스트: 1개 (deleteAllRecurringEvents 내부 로직)
  - `useEventOperations.spec.ts`: `deleteAllRecurringEvents` 함수가 `findRecurringGroupEvents`와 `callApi`를 올바르게 호출하는지, 에러 처리를 하는지 등 순수 로직 검증.
- 통합 테스트: 7개 (App 컴포넌트와 훅의 상호작용)
  - `App.recurringDelete.spec.tsx`: `App` 컴포넌트의 UI 상호작용 (버튼 클릭, 다이얼로그 표시, 버튼 클릭 시 훅 호출) 및 훅의 Mock API 응답에 따른 UI 변화를 검증.
- E2E 테스트: 0개 (현재 단계에서는 통합 테스트로 충분)

### 근거

- 단위 테스트 중심: `deleteAllRecurringEvents`와 같은 핵심 비즈니스 로직은 빠르게 피드백을 받을 수 있는 단위 테스트로 검증합니다.
- 통합 테스트 보완: 사용자 인터랙션과 UI 변화를 검증하는 데는 `App` 컴포넌트와 `useEventOperations` 훅의 통합 테스트가 가장 효과적입니다. 실제 사용 시나리오를 반영하면서도 외부 API는 Mocking하여 테스트 속도와 안정성을 확보합니다.
- E2E 최소화: 현재 기능은 복잡한 전체 사용자 플로우를 포함하지 않으므로, E2E 테스트는 추후 필요성이 생길 때 추가합니다.

## 테스트 품질 체크리스트

작성된 테스트 케이스가 다음을 만족하는지 확인:

- [x] 사용자 관점에서 작성되었는가?
- [x] 비즈니스 가치를 검증하는가?
- [x] 테스트 이름만으로 무엇을 검증하는지 이해 가능한가?
- [x] 실패 시 문제 위치를 명확히 알 수 있는가?
- [x] 다른 테스트와 독립적으로 실행 가능한가?
- [x] Given-When-Then이 명확히 구분되는가?
- [x] 엣지 케이스와 에러 케이스를 포함하는가?
- [x] Mock을 적절히 사용하여 외부 의존성을 제어하는가?
- [x] 구현 세부사항이 아닌 동작을 테스트하는가?
- [x] 단언문(assertion)이 명확하고 구체적인가?
